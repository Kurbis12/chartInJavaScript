<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable Line Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-moment"></script>
</head>

<body>
    <canvas id="myChart" width="600" height="400" style="border: 1px solid #000;"></canvas>

    <script>
        const data = {
            labels: Array.from({
                length: 40
            }, (_, i) => i * 10),
            datasets: [{
                label: 'Draggable Line',

                borderColor: 'blue', //line color
                type: 'scatter',
                data: [{
                    y: 0,
                    x: new Date('2023-01-01T00:00:00').getTime(),
                    laps_completed: 5
                }, {
                    y: 15,
                    x: new Date('2023-01-01T01:15:00').getTime(),
                    laps_completed: 12
                }, {
                    y: 30,
                    x: new Date('2023-01-01T02:30:00').getTime(),
                    laps_completed: 18
                }, {
                    y: 45,
                    x: new Date('2023-01-01T03:45:00').getTime(),
                    laps_completed: 25
                }, {
                    y: 60,
                    x: new Date('2023-01-01T05:00:00').getTime(),
                    laps_completed: 33
                }, {
                    y: 75,
                    x: new Date('2023-01-01T06:15:00').getTime(),
                    laps_completed: 40
                }, {
                    y: 90,
                    x: new Date('2023-01-01T07:30:00').getTime(),
                    laps_completed: 48
                }, {
                    y: 105,
                    x: new Date('2023-01-01T08:45:00').getTime(),
                    laps_completed: 55
                }, {
                    y: 120,
                    x: new Date('2023-01-01T10:00:00').getTime(),
                    laps_completed: 62
                }, {
                    y: 135,
                    x: new Date('2023-01-01T11:15:00').getTime(),
                    laps_completed: 70
                }, {
                    y: 150,
                    x: new Date('2023-01-01T12:30:00').getTime(),
                    laps_completed: 78
                }, {
                    y: 165,
                    x: new Date('2023-01-01T13:45:00').getTime(),
                    laps_completed: 85
                }, {
                    y: 180,
                    x: new Date('2023-01-01T15:00:00').getTime(),
                    laps_completed: 90
                }, {
                    y: 195,
                    x: new Date('2023-01-01T16:15:00').getTime(),
                    laps_completed: 95
                }, {
                    y: 210,
                    x: new Date('2023-01-01T17:30:00').getTime(),
                    laps_completed: 97
                }, {
                    y: 225,
                    x: new Date('2023-01-01T18:45:00').getTime(),
                    laps_completed: 98
                }, {
                    y: 240,
                    x: new Date('2023-01-01T20:00:00').getTime(),
                    laps_completed: 99
                }, {
                    y: 255,
                    x: new Date('2023-01-01T21:15:00').getTime(),
                    laps_completed: 100
                }, {
                    y: 270,
                    x: new Date('2023-01-01T22:30:00').getTime(),
                    laps_completed: 100
                }, {
                    y: 285,
                    x: new Date('2023-01-01T23:45:00').getTime(),
                    laps_completed: 100
                }, {
                    y: 300,
                    x: new Date('2023-01-01T24:00:00').getTime(),
                    laps_completed: 100
                }, ],
                backgroundColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 2.5,
                fill: false, // Fill area under the line
                pointRadius: 10, // line point size
                pointHitRadius: 25, //Radius around line point
                showLine: true //shows line
            }]
        };
        const ctx = document.getElementById('myChart').getContext('2d');

        const chart = new Chart(ctx, {
            type: 'scatter',
            data: data, // data goes here 
            options: {
                layout: {
                    padding: { //chat padding from grid frame
                        left: 20,
                        right: 20,
                        top: 20,
                        bottom: 10
                    }
                },
                scales: {
                    y: {
                        type: 'linear', //x label type
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)',
                            borderColor: 'rgba(0, 0, 0, 0.5)',
                            borderWidth: 1
                        },
                        title: {
                            display: true, // Label Title shows at x axel
                            text: 'Amount' //Name of Title
                        },
                        min: 0, // Set a fixed minimum value
                        max: 350, // Set a fixed maximum value
                    },
                    x: {
                        type: 'time', //y label type
                        time: {
                            unit: 'minute', // can use hour. in this case step is 40 min 
                            displayFormats: {
                                minute: 'HH:mm'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)', //grid horizontal line color
                            borderColor: 'rgba(0, 0, 0, 0.5)', // border color
                            borderWidth: 1
                        },
                        title: {
                            display: true,
                            text: 'Time'
                        },
                        min: new Date('2023-01-01T00:00:00').getTime(), // Set a fixed minimum date in milliseconds
                        max: new Date('2023-01-01T24:00:00').getTime(), // Set a fixed maximum date in milliseconds
                    }
                },
                plugins: {
                    dragData: {
                        round: 1,
                        showTooltip: true,
                        dragX: true,
                        dragDataRound: 1,
                        onDragStart: function(event, element) {
                            // Save the original x value when start to drag
                            element._originalX = element._index;
                        },
                        onDrag: function(event, datasetIndex, index, value) {
                            const previousIndex = index - 1;
                            const nextIndex = index + 1;

                            // Drag piont cant go further then previous point on line
                            if (previousIndex >= 0 && value.x < data.datasets[datasetIndex].data[previousIndex].x) {
                                value.x = data.datasets[datasetIndex].data[previousIndex].x;
                            }

                            // Drag piont cant go further then next point on line
                            if (nextIndex < data.datasets[datasetIndex].data.length && value.x > data.datasets[datasetIndex].data[nextIndex].x) {
                                value.x = data.datasets[datasetIndex].data[nextIndex].x;
                            }
                        },
                        onDragEnd: function(event, datasetIndex, index, value) {
                            // console log , end of drag event
                            console.log('Drag end:', event, datasetIndex, index, value);
                        },
                        tooltipFormat: (model) => {
                            return `(${model.xLabel}, ${model.yLabel.toISOString().substr(11, 5)})`;
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>
